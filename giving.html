<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Give | Journey Village Church</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

    // ✅ Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBRkHjmEN5ltTlWOnT0czVSfhY1homobm8",
      authDomain: "journeyvill.firebaseapp.com",
      projectId: "journeyvill",
      storageBucket: "journeyvill.firebasestorage.app",
      messagingSenderId: "494172807963",
      appId: "1:494172807963:web:2b25b43dfb40a24f1929be",
      measurementId: "G-E1RNC9M7CK"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // ✅ Handle login form
    const loginForm = document.getElementById("login-form");
    if (loginForm) {
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("login-email").value;
        const password = document.getElementById("login-password").value;

        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          const token = await userCredential.user.getIdToken();
          localStorage.setItem("authToken", token);
          alert("Login successful ✅");
          window.location.href = "index.html"; // or check role and redirect
        } catch (err) {
          alert("Login failed: " + err.message);
        }
      });
    }

    // ✅ Logout function
    window.logout = function () {
      signOut(auth).then(() => {
        localStorage.removeItem("authToken");
        window.location.href = "login.html";
      });
    };

    // ✅ Auto-check session on page load
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        console.log("Not logged in");
        // optional: window.location.href = "login.html";
      } else {
        console.log("Logged in as:", user.email);
      }
    });
  </script>


  <!-- Header (Same as your main site) -->
  <header class="header" id="home">
    <nav>
      <div class="nav__bar">
        <div class="logo nav__logo">
          <a href="/"><img src="logo.png" alt="Journey Village Church Logo" loading="lazy"></a>
        </div>
        <ul class="nav__links" id="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="/about">About Us</a></li>
          <li><a href="events.html">Events</a></li>
          <li><a href="giving.html" class="active">Giving</a></li>
          <li><a href="/contact">Contact</a></li>
          <li><a href="/news">News</a></li>
        </ul>
        <div class="nav__menu__btn" id="menu-btn">
          <i class="ri-menu-line"></i>
        </div>
        <!-- Account Authentication Modal -->
        <div class="account-modal" id="account-modal">
          <div class="modal-content">
            <span class="close-modal">&times;</span>
            
            <div class="auth-tabs">
              <button class="auth-tab active" data-tab="login">Sign In</button>
              <button class="auth-tab" data-tab="register">Create Account</button>
            </div>
            
            <div class="auth-content active" id="login">
              <form class="auth-form" id="login-form">
                <div class="form-group">
                  <label for="login-email">Email or Phone</label>
                  <input type="text" id="login-email" required>
                </div>
                <div class="form-group">
                  <label for="login-password">Password</label>
                  <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn btn__primary">Sign In</button>
                <a href="#forgot-password" class="text-link">Forgot password?</a>
              </form>
            </div>
            
            <div class="auth-content" id="register">
              <form class="auth-form" id="register-form">
                <div class="form-group">
                  <label for="reg-name">Full Name</label>
                  <input type="text" id="reg-name" required>
                </div>
                <div class="form-group">
                  <label for="reg-phone">Phone Number</label>
                  <input type="tel" id="reg-phone" pattern="[0-9]{10}" required>
                  <small>Format: 07XXXXXXXX</small>
                </div>
                <div class="form-group">
                  <label for="reg-email">Email</label>
                  <input type="email" id="reg-email">
                </div>
                <div class="form-group">
                  <label for="reg-password">Password</label>
                  <input type="password" id="reg-password" minlength="8" required>
                </div>
                <button type="submit" class="btn btn__primary">Create Account</button>
              </form>
            </div>
          </div>
        </div>
        <div class="nav__action__btn">
          <button class="btn" id="account-btn">
            <span><i class="ri-user-line"></i></span> Account
          </button>
        </div>
      </div>
    </nav>
  </header>

  <!-- Main Giving Content -->
  <main class="giving-page">
    <section class="giving-hero">
      <div class="section__container">
        <div class="hero-content">
          <h1>Partner With Our Mission</h1>
          <p class="scripture">"Each of you should give what you have decided in your heart to give..." <br><span>2 Corinthians 9:7</span></p>
        </div>
      </div>
    </section>

    <section class="giving-options">
      <div class="section__container">
        <h2 class="section__upperheader">Ways to Give</h2>
        
        <div class="donation-cards">
          <!-- M-Pesa Card -->
          <div class="donation-card mpesa-card">
            <div class="card-header">
              <i class="ri-smartphone-line"></i>
              <h3>M-Pesa Mobile Giving</h3>
            </div>
            <div class="card-body">
              <form id="mpesa-form">
                <div class="form-group">
                  <label for="amount">Amount (KES)</label>
                  <div class="input-with-icon">
                    <span class="currency">KES</span>
                    <input type="number" id="amount" min="10" placeholder="500" required>
                  </div>
                </div>
                <div class="form-group">
                  <label for="phone">M-Pesa Number</label>
                  <div class="input-with-icon">
                    <span class="prefix">+254</span>
                    <input type="tel" id="phone" pattern="[0-9]{9}" placeholder="712345678" required>
                  </div>
                  <small class="hint">Format: 7XXXXXXXX (without 0)</small>
                </div>
                <button type="submit" class="btn btn__primary" id="mpesa-button">
                  <i class="ri-send-plane-fill"></i> Send Payment Request
                </button>
              </form>
              <div class="payment-status" id="mpesa-status"></div>
            </div>
            <div class="card-footer">
              <p><i class="ri-information-line"></i> You'll receive an STK Push on your phone to complete payment</p>
            </div>
          </div>

          <!-- Bank Transfer Card -->
          <div class="donation-card bank-card">
            <div class="card-header">
              <i class="ri-bank-line"></i>
              <h3>Bank Transfer</h3>
            </div>
            <div class="card-body">
              <div class="bank-details">
                <div class="detail-row">
                  <span class="detail-label">Bank Name:</span>
                  <span class="detail-value">Kenya Commercial Bank</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Account Name:</span>
                  <span class="detail-value">Journey Village Church</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Account Number:</span>
                  <span class="detail-value">1234567890</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Branch:</span>
                  <span class="detail-value">Kikuyu</span>
                </div>
              </div>
              <button class="btn btn__outline copy-btn" data-clipboard-text="Journey Village Church, KCB Kikuyu, A/C 1234567890">
                <i class="ri-file-copy-line"></i> Copy Details
              </button>
            </div>
          </div>

          <!-- Recurring Giving Card -->
          <div class="donation-card recurring-card">
            <div class="card-header">
              <i class="ri-calendar-event-line"></i>
              <h3>Recurring Giving</h3>
              <div class="popular-badge">Recommended</div>
            </div>
            <div class="card-body">
              <form id="recurring-form">
                <div class="form-group">
                  <label>Monthly Amount (KES)</label>
                  <div class="amount-options">
                    <button type="button" class="amount-option" data-amount="500">500</button>
                    <button type="button" class="amount-option" data-amount="1000">1,000</button>
                    <button type="button" class="amount-option" data-amount="2000">2,000</button>
                    <input type="number" id="custom-amount" placeholder="Other amount" min="100">
                  </div>
                </div>
                <div class="form-group">
                  <label for="frequency">Frequency</label>
                  <select id="frequency">
                    <option value="monthly">Monthly</option>
                    <option value="weekly">Weekly</option>
                  </select>
                </div>
                <button type="submit" class="btn btn__primary">
                  <i class="ri-restart-line"></i> Set Up Recurring Giving
                </button>
              </form>
            </div>
            <div class="card-footer">
              <p><i class="ri-lightbulb-flash-line"></i> Consistent giving helps us plan our ministry work</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Giving FAQ -->
    <section class="giving-faq">
      <div class="section__container">
        <h2 class="section__upperheader">Giving FAQs</h2>
        
        <div class="faq-container">
          <div class="faq-item">
            <button class="faq-question">
              <span>How do I complete the M-Pesa payment?</span>
              <i class="ri-arrow-down-s-line"></i>
            </button>
            <div class="faq-answer">
              <p>After submitting your donation, you'll receive an M-Pesa push notification on your phone. Simply enter your M-Pesa PIN when prompted to complete the transaction. The amount will be deducted from your M-Pesa account.</p>
            </div>
          </div>
          
          <div class="faq-item">
            <button class="faq-question">
              <span>Will I get a receipt for my donation?</span>
              <i class="ri-arrow-down-s-line"></i>
            </button>
            <div class="faq-answer">
              <p>Yes! You'll receive two receipts: 1) An automatic SMS receipt from M-Pesa immediately after payment, and 2) An official donation receipt from Journey Village Church emailed to you within 24 hours (if you provide your email).</p>
            </div>
          </div>
          
          <div class="faq-item">
            <button class="faq-question">
              <span>Is online giving secure?</span>
              <i class="ri-arrow-down-s-line"></i>
            </button>
            <div class="faq-answer">
              <p>Absolutely. We use Safaricom's secure M-Pesa API for all transactions. We never see or store your M-Pesa PIN. All transactions are encrypted and processed directly with Safaricom's systems.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="section__container footer__container">
      <div class="footer__col">
        <div class="footer__logo">
          <img src="logo.png" alt="Journey Village Church Logo" loading="lazy">
        </div>
        <p>QM54+ J2H, Rungiri<br>Kiambu, Kenya</p>
        <div class="footer__socials">
          <a href="#" aria-label="Facebook"><i class="ri-facebook-fill"></i></a>
          <a href="#" aria-label="Instagram"><i class="ri-instagram-fill"></i></a>
          <a href="#" aria-label="YouTube"><i class="ri-youtube-fill"></i></a>
        </div>
      </div>
      
      <div class="footer__col">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="/about">About Us</a></li>
          <li><a href="/beliefs">Our Beliefs</a></li>
          <li><a href="/sermons">Sermons</a></li>
          <li><a href="/events">Events</a></li>
        </ul>
      </div>
      
      <div class="footer__col">
        <h3>Get Involved</h3>
        <ul>
          <li><a href="/serve">Serve</a></li>
          <li><a href="/give">Give</a></li>
          <li><a href="/prayer">Prayer</a></li>
          <li><a href="/contact">Contact</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer__bottom">
      <p>&copy; 2025 Journey Village Church. All rights reserved.</p>
    </div>
  </footer>

  <!-- Payment Processing Modal -->
  <div class="payment-modal" id="payment-modal">
    <div class="modal-content">
      <div class="modal-body">
        <div class="loader" id="payment-loader">
          <div class="loader-circle"></div>
          <div class="loader-circle"></div>
          <div class="loader-circle"></div>
        </div>
        <h3 id="payment-message">Processing your donation...</h3>
        <p id="payment-details"></p>
      </div>
      <button class="btn btn__outline" id="close-payment-modal">Close</button>
    </div>
  </div>

  <script src="giving.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
</body>
</html>